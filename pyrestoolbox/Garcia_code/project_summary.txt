GARCIA EXTENSION PROJECT - SUMMARY
====================================

WHAT WAS DONE
-------------

This project extends Garcia's (2001) widely-used density mixing rule from
CO2-only to 8 dissolved gases: CO2, CH4, C2H6, C3H8, n-C4H10, H2S, H2, N2.

Garcia's density mixing rule (his Eq. 18) is already gas-generic:

    rho = (1 + x2*M2/(M1*x1)) / (x2*V_phi/(M1*x1) + 1/rho1)

It only needs three inputs per gas:
    - V_phi: apparent molar volume of dissolved gas (cm3/mol)
    - M2: molecular weight of the gas (g/mol)
    - x2: mole fraction of dissolved gas in the liquid phase

Garcia provided a cubic polynomial for V_phi of CO2 only. To extend to other
gases, we implemented the Plyasunov A12-infinity model (Plyasunov et al.,
2019-2021, Parts I-IV), which computes V_phi from first-principles
thermodynamics for any of the 8 target gases at arbitrary temperature and
pressure.

For mixed dissolved gases, we use mole-fraction-weighted effective properties:
    V_phi_eff = sum(yi * V_phi_i)
    MW_eff = sum(yi * MW_i)
where yi is the fraction of gas i among all dissolved gases, then apply
Garcia's equation with the effective values.


APPROACH
--------

The Plyasunov model uses Fluctuation Solution Theory:

    1. Compute A12_inf (dimensionless) from a polynomial in pure water
       density, with temperature-dependent coefficients specific to each gas.
    2. Recover V_phi = A12_inf * kappa_T * R * T
       where kappa_T is the isothermal compressibility of pure water.

Water properties (density, compressibility) come from IAPWS. Two backends
are available: the iapws Python library (IAPWS-95, for pyResToolbox), or
a from-scratch IAPWS-IF97 Region 1 implementation (for ResToolbox3/Dart,
~130 lines, no external dependencies). IF97 agrees with IAPWS-95 to within
0.014 kg/m3 on density and 0.2% on compressibility — negligible for our
purposes. The Plyasunov coefficients come from three papers:
    - Part II (2020): CO2, C2H6, C3H8, n-C4H10
    - Part III (2021): H2S
    - Part IV (2021): H2, N2, CH4 (supersedes Part I)

All three papers use the same equation form, so one implementation covers
all 8 gases. Brine base density uses the Spivey et al. (modified) correlation
from McCain (2011), consistent with pyResToolbox.


KEY RESULTS
-----------

V_phi at 298.15 K, 0.1 MPa (all within 0.1% of Plyasunov reference values):

    Gas       MW (g/mol)   V_phi (cm3/mol)   Density effect (x2=0.02)
    H2          2.016         26.1            -2.64% (decreases)
    N2         28.013         34.7            -0.75% (decreases)
    CH4        16.043         37.0            -2.29% (decreases)
    CO2        44.010         34.0            +1.10% (increases)
    C2H6       30.069         51.4            -2.30% (decreases)
    C3H8       44.096         67.1            -2.42% (decreases)
    n-C4H10    58.122         82.8            -2.57% (decreases)
    H2S        34.081         34.8            -0.10% (near neutral)

Temperature dependence validated against Hnedkovsky et al. (1996) experimental
data for CH4, CO2, and H2S at 25-250C, 30 MPa (max errors: 2.4%, 2.6%, 3.8%).

CO2 density increase at x2=0.05: +2.69% (Garcia reports ~2.5%).

28 validation checks pass covering reference values, experimental data,
Garcia polynomial comparison, density predictions, and physical reasonableness.


WHAT IS NOT NOVEL
-----------------

This work collates existing published models:
    - Garcia (2001): density mixing rule (already gas-generic)
    - Plyasunov et al. (2019-2021): V_phi model (already covers all 8 gases)
    - IAPWS-95: water properties (standard)
    - Spivey et al.: brine density (standard, already in pyResToolbox)

The contribution is practical: a validated, unified implementation that makes
multi-gas density corrections available for reservoir engineering workflows.
The mixed-gas extension uses standard ideal mixing of apparent molar volumes.


IMPLEMENTATION NOTES FOR PYRESTOOLBOX (Python)
----------------------------------------------

pyResToolbox already uses Garcia Eq. 18 for CO2 density correction in
brine_props_co2() via garciaDensity(). The existing garciaDensity() function
is already gas-generic -- it accepts MwG as a parameter. Only partMolVol()
needs generalization: replace the CO2-specific cubic polynomial with a call
to the Plyasunov model that returns V_phi for any gas.

For water properties (rho, kappa_T), use the iapws Python library. Or
implement IF97 Region 1 from scratch to avoid the dependency (34-term
polynomial, see code/iapws_if97.py).

For mixed gases, compute effective V_phi and MW as weighted averages, then
call the existing garciaDensity() with those effective values.

The Spivey brine density correlation should be KEPT for brine base density.
It cannot be replaced with IAPWS because the salt correction equations
(Eqs 4.6-4.8) depend on intermediate Spivey values (rhow_t70, Ewt, Fwt)
that IAPWS does not provide. IAPWS is used only for the Plyasunov model's
pure water property inputs. The two do not conflict.

IMPLEMENTATION NOTES FOR RESTOOLBOX3 (Dart/Flutter)
----------------------------------------------------

ResToolbox3 cannot use the iapws Python library. Instead, implement
IAPWS-IF97 Region 1 from scratch in Dart:
    - 34 coefficient triplets as a hardcoded table
    - One polynomial evaluation with 1st and 2nd pi-derivatives
    - Two formulas: rho = Pstar/(R*T*gamma_pi), kappa_T = -gamma_pipi/(gamma_pi*Pstar)
    - Total: ~100-150 lines of Dart

Then implement the Plyasunov model and Garcia mixing rule on top.
All are pure arithmetic — no special libraries needed.

See code/iapws_if97.py for a reference implementation that can be
translated line-by-line to Dart.

COMMON NOTES
------------

Full implementation specification with all coefficients is in:
    code/pyrestoolbox_integration.txt

IMPORTANT: The Plyasunov p_in coefficients require 7-8 significant digits.
Polynomial terms reach magnitudes of ~6 but must cancel to ~0.03-0.07.
Truncating coefficients produces wildly incorrect results. The coefficients
in pyrestoolbox_integration.txt were manually verified against the original
papers after OCR extraction produced systematic sign errors.


CODE FILES
----------

    code/iapws_if97.py          - IAPWS-IF97 Region 1 (from scratch, portable)
    code/water_properties.py    - Water properties wrapper (IF97 or IAPWS-95)
    code/plyasunov_model.py     - Plyasunov A12-inf model (8 gases)
    code/garcia_mixing.py       - Garcia density mixing rule
    code/brine_properties.py    - Brine density (Spivey + Batzle-Wang)
    code/validation.py          - 28-check validation suite
    code/pyrestoolbox_integration.txt - Full integration spec (both targets)


REFERENCES
----------

Garcia (2001): LBNL-49023, DOI: 10.2172/790022
Hnedkovsky, Wood & Majer (1996): J. Chem. Thermodynamics 28, 125-142
Plyasunov & Korzhinskaya (2020): Fluid Phase Equilibria 521, 112690 (Part II)
Plyasunov & Korzhinskaya (2021): Fluid Phase Equilibria, 112872 (Part III)
Plyasunov & Korzhinskaya (2021): Fluid Phase Equilibria 536, 112982 (Part IV)
